"use strict";

(function (_window, _document) {
    if (!NodeList.prototype.forEach) {
        NodeList.prototype.forEach = function (a) {
            for (var b = 0; b < this.length; b++) {
                a(this[b], b, this);
            }
        };
    }
    var $ = function $(selector) {
        return _document.querySelectorAll(selector);
    };
    var doReset = _window.location.search.match("ek=clear");
    if (!doReset && localStorage.ek) {
        var ek = JSON.parse(localStorage.ek),
            list = $(ek.selector),
            ele = list[ek.index];
        if (ele) {
            if (ele.src) {
                _window.location = ele.src;
                return;
            } else {
                alert("Click Play button");
            }
        }
    }

    var searchNode = ["video", "source", "iframe"];

    searchNode.forEach(function (selector) {
        $(selector).forEach(function (ele, index) {

            if (ele.src) {
                _document.write("<div><a data-selector='" + selector + "' data-index='" + index + "' href='" + ele.src + "'>" + ele.src + "</a></div><hr>");
            }
        });
    });

    $("a").forEach(function (ele) {
        ele.addEventListener("click", function (evt) {
            evt.preventDefault();
            var data = evt.currentTarget.dataset;
            localStorage.ek = JSON.stringify({
                "selector": data.selector,
                "index": data.index
            });

            return;
        });
    });
})(window, document);
